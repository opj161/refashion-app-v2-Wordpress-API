# RefashionAI API v1 Documentation

## Overview

The RefashionAI API v1 provides a RESTful, asynchronous interface for image generation tasks. The API follows a job-based pattern where clients submit generation requests and poll for completion status.

### Base URL
```
https://your-domain.com/api/v1
```

### API Pattern
1. **Submit Job**: POST to `/generate` → Receive `jobId` immediately
2. **Poll Status**: GET `/status/{jobId}` → Check completion status
3. **Retrieve Results**: Results are provided in the status response when complete

---

## Authentication

All API requests require authentication via API keys.

### Getting an API Key
API keys must be generated by an administrator through the RefashionAI admin interface:
1. Admin logs into RefashionAI
2. Navigates to Admin → Users
3. Edits the target user
4. Clicks "Generate New API Key"
5. Copies the generated key (shown only once)

### Using the API Key
Include the API key in the `Authorization` header of all requests:

```http
Authorization: Bearer rf_your_api_key_here
```

---

## Endpoints

### POST /api/v1/generate

Submits a new image generation job.

#### Request

**Method:** `POST`  
**Content-Type:** `application/json`  
**Headers:**
```http
Authorization: Bearer rf_your_api_key_here
Content-Type: application/json
```

**Body:**
```json
{
  "imageDataUri": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "parameters": {
    "gender": "female",
    "bodyType": "athletic",
    "bodySize": "medium",
    "ageRange": "25-35",
    "ethnicity": "caucasian",
    "poseStyle": "standing",
    "background": "studio",
    "fashionStyle": "casual",
    "hairStyle": "long",
    "modelExpression": "neutral",
    "lightingType": "natural",
    "lightQuality": "soft",
    "cameraAngle": "front",
    "lensEffect": "standard",
    "depthOfField": "normal",
    "timeOfDay": "day",
    "overallMood": "bright",
    "fabricRendering": "realistic"
  },
  "settingsMode": "basic"
}
```

**Parameter Descriptions:**
- `imageDataUri`: Base64-encoded image data URI of the clothing item
- `parameters`: Model generation parameters (all fields required)
- `settingsMode`: Either "basic" or "advanced" (optional, defaults to "basic")

#### Response

**Success (202 Accepted):**
```json
{
  "jobId": "uuid-string",
  "status": "processing"
}
```

**Error (400 Bad Request):**
```json
{
  "error": "Invalid request data",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": ["imageDataUri"],
      "message": "Image data URI is required"
    }
  ]
}
```

**Error (401 Unauthorized):**
```json
{
  "error": "Unauthorized"
}
```

**Error (500 Internal Server Error):**
```json
{
  "error": "Internal server error"
}
```

---

### GET /api/v1/status/{jobId}

Polls the status of a generation job.

#### Request

**Method:** `GET`  
**Headers:**
```http
Authorization: Bearer rf_your_api_key_here
```

**Path Parameters:**
- `jobId`: The job ID returned from the generate endpoint

#### Response

**Processing (200 OK):**
```json
{
  "jobId": "uuid-string",
  "status": "processing"
}
```

**Completed (200 OK):**
```json
{
  "jobId": "uuid-string",
  "status": "completed",
  "generatedImageUrls": [
    "https://your-domain.com/uploads/generated_images/image1.jpg",
    "https://your-domain.com/uploads/generated_images/image2.jpg",
    "https://your-domain.com/uploads/generated_images/image3.jpg"
  ]
}
```

**Failed (200 OK):**
```json
{
  "jobId": "uuid-string",
  "status": "failed",
  "error": "Error message describing what went wrong"
}
```

**Job Not Found (404 Not Found):**
```json
{
  "error": "Job not found"
}
```

**Unauthorized (401 Unauthorized):**
```json
{
  "error": "Unauthorized"
}
```

---

## CORS Support

The API supports Cross-Origin Resource Sharing (CORS) for the following domains:
- `https://marcodirenzo.ch`
- `https://demo.marcodirenzo.ch`

If you need additional domains whitelisted, contact the system administrator.

---

## Rate Limiting

Currently, there are no specific rate limits implemented. However, the asynchronous nature of the API naturally throttles requests since each job must complete before new results are available.

---

## Error Handling

### HTTP Status Codes
- `202 Accepted`: Job submitted successfully
- `200 OK`: Status retrieved successfully
- `400 Bad Request`: Invalid request data or format
- `401 Unauthorized`: Invalid or missing API key
- `404 Not Found`: Job not found or not accessible
- `500 Internal Server Error`: Server-side error occurred

### Error Response Format
All error responses follow this format:
```json
{
  "error": "Human-readable error message",
  "details": "Optional additional error details"
}
```

---

## Example Usage

### Complete Workflow Example

1. **Submit a generation job:**
```bash
curl -X POST https://your-domain.com/api/v1/generate \
  -H "Authorization: Bearer rf_your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{
    "imageDataUri": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
    "parameters": {
      "gender": "female",
      "bodyType": "athletic",
      "bodySize": "medium",
      "ageRange": "25-35",
      "ethnicity": "caucasian",
      "poseStyle": "standing",
      "background": "studio",
      "fashionStyle": "casual",
      "hairStyle": "long",
      "modelExpression": "neutral",
      "lightingType": "natural",
      "lightQuality": "soft",
      "cameraAngle": "front",
      "lensEffect": "standard",
      "depthOfField": "normal",
      "timeOfDay": "day",
      "overallMood": "bright",
      "fabricRendering": "realistic"
    },
    "settingsMode": "basic"
  }'
```

2. **Poll for status (repeat until status is not "processing"):**
```bash
curl -X GET https://your-domain.com/api/v1/status/your-job-id-here \
  -H "Authorization: Bearer rf_your_api_key_here"
```

3. **Retrieve results from the completed status response**

### WordPress Plugin Integration

For WordPress plugin developers:

```php
// Submit generation job
$response = wp_remote_post('https://your-domain.com/api/v1/generate', [
    'headers' => [
        'Authorization' => 'Bearer ' . $api_key,
        'Content-Type' => 'application/json',
    ],
    'body' => json_encode($job_data),
    'timeout' => 30,
]);

$job = json_decode(wp_remote_retrieve_body($response), true);
$job_id = $job['jobId'];

// Poll for completion
do {
    sleep(5); // Wait 5 seconds between polls
    
    $status_response = wp_remote_get(
        'https://your-domain.com/api/v1/status/' . $job_id,
        [
            'headers' => [
                'Authorization' => 'Bearer ' . $api_key,
            ],
            'timeout' => 15,
        ]
    );
    
    $status = json_decode(wp_remote_retrieve_body($status_response), true);
    
} while ($status['status'] === 'processing');

// Handle results
if ($status['status'] === 'completed') {
    $image_urls = $status['generatedImageUrls'];
    // Process the generated images
} else if ($status['status'] === 'failed') {
    $error = $status['error'];
    // Handle the error
}
```

---

## Support

For technical support or to request additional API features, please contact the system administrator.

**API Version:** 1.0  
**Last Updated:** July 8, 2025
